@page "/library"
@using Misuzu.Database.Models
@using Misuzu.Services
@inject Realms.Realm Realm
@rendermode InteractiveServer

<PageTitle>Library - Misuzu</PageTitle>

<div class="space-y-6">
    <div class="flex items-center justify-between">
        <h1 class="text-3xl font-bold text-white">My Library</h1>
    </div>

    <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-6">
        <div @onclick="ShowAddModal" 
             class="cursor-pointer bg-zinc-900 border-2 border-dashed border-zinc-700 hover:border-purple-500 transition-colors shadow-lg flex flex-col items-center justify-center">
            <svg class="w-16 h-16 text-zinc-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
            </svg>
            <p class="text-zinc-500 mt-2 font-medium">Add New</p>
        </div>

        @foreach (var entry in entries)
        {
            <LibraryEntryCard Entry="entry" />
        }
    </div>
</div>

<LibraryEntryModal IsOpen="isModalOpen" 
                    Entry="new LibraryEntry()" 
                    OnClose="CloseModal" 
                    OnSave="HandleSave"
                    IsEditMode="false"/>

@code {
    private List<LibraryEntry> entries = new();
    private bool isModalOpen = false;

    protected override void OnInitialized()
    {
        entries = Realm.All<LibraryEntry>().OrderBy(e => e.Title).ToList();
    }

    private void ShowAddModal()
    {
        isModalOpen = true;
    }

    private void CloseModal()
    {
        isModalOpen = false;
    }

    private void HandleSave()
    {
        entries = Realm.All<LibraryEntry>().OrderBy(e => e.Title).ToList();
    }
}
